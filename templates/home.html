{% extends "home_base.html" %}
{% load static %}
{% block title%}Thue xe - Trang chủ{% endblock %}

{% block mycss %}
    {{ block.super }}
    <link rel="stylesheet" href="{% static 'rent/home/css/home_rent.css' %}">
    <link rel="stylesheet" href="{% static 'rent/chucnangthuexe/css/main.css' %}">
    <link rel="stylesheet" href="{% static 'rent/chucnangthuexe/css/popup.css' %}">
{% endblock %}
{% block content %}
    <section class="hero-image">
        <div class="container">
            <div class="hero-content">
                <div class="row align-items-center">
                    <div class="col-md-7 d-block  d-md-block d-sm-none text-left">
                        <div class="key-slogan">
                            <h1>Dịch vụ thuê xe máy</h1>
                            <p>Chúng tôi hiểu cảm giác của người đi thuê xe máy phải bỏ ra một số tiền để có được một chiếc xe đủ tốt, không gặp rắc rối khi đi trên đường. Tuy nhiên thật khó để tìm được một đơn vị cung cấp dịch vụ cho thuê xe uy tín, chất lượng hiện nay. GIII - tiên phong trở thành đơn vị số 1 về cung cấp dịch vụ thuê xe máy tự lái tại Việt Nam.</p>
                        </div>
                    </div>
                    <div class="col-md-5" data-select2-id="6">
                        <div class="car-rental-wrapper">
                            <div class="main-wrapper">
                                <form method="post" action="" id="thue-xe-form">
                                    {% csrf_token %}
                                    <div class="inputs">
                                        <div class="content locations">
                                            <h4 class="location-title">
                                                Thông tin nhận xe                    
                                            </h4>
                                            <div class="content-inputs">
                                                <div class="location-drop">
                                                    <i class='bx bx-map'></i>
                                                    <select id="pickup_location" class="selectpicker form-control" name="pickup_location">
                                                        <option>Chọn điểm nhận xe</option> 
                                                        {% for dia_diem in dia_diems %}
                                                            <option>{{ dia_diem.ten }}</option>
                                                        {% endfor %}
                                                    </select>
                                                </div>
                                                <div class="same-return">
                                                    <div class="checkbox-wrapper-22">
                                                        <label class="switch" for="same-return">
                                                          <input type="checkbox" id="same-return" />
                                                          <div class="slider round"></div>
                                                        </label>
                                                    </div>
                                                    <label class="same-return-content">Nhận, trả xe cùng địa điểm</label>
                                                </div>
                                                
                                            </div>   
                                        </div>   
                                        <div class="content dates">
                                            <div class="content-inputs">
                                                <div class="date-select">
                                                    <i class='bx bx-calendar'></i>
                                                    <input class="second-row-input form-control" id="today" type="date" name="order_day">
                                                </div>
                                                <h4 class="location-title">Thông tin trả xe</h4>
                                                <div id="return_loc_wrapper" class="location-drop">
                                                    <i class='bx bx-map'></i>
                                                    <select id="return_location" class="selectpicker form-control" name="return_location">
                                                        <option>Chọn điểm trả xe</option> 
                                                        {% for dia_diem in dia_diems %}
                                                            <option>{{ dia_diem.ten }}</option>
                                                        {% endfor %}
                                                    </select>                          
                                                </div>
                                                <div class="date-select">
                                                    <i class='bx bx-calendar'></i>
                                                    <input class="second-row-input form-control" id="return-day" type="date" name="return_day">
                                                </div>
                                            </div>   
                                        </div>   

                                        <div class="content submit">
                                            <div class="content-inputs">
                                                <div class="submit-wrapper">
                                                    <input type="submit" value="TÌM KIẾM" class="second-row-input car-rental-do-search button-submit" id="booking-form-submit">
                                                </div>
                                            </div>   
                                        </div>  
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>
    
    {% include "rent/thue_xe_tai.html" %}
    
    <section class="s-list-moto">
        <div class="container" style="height:100vh;">
            <h2 class="s-title"><span>DANH MỤC XE MÁY</span></h2>
            <p class="sub-title">
                 Toàn bộ xe máy cho thuê của chúng tôi là xe được mua mới 100%, được đăng ký chính chủ. Ngoài ra, các xe sau khi kết thúc hợp đồng với khách sẽ được kiểm tra, bảo dưỡng, thay thế các bộ phận hỏng hóc và phải đạt chuẩn an toàn xe trước khi giao cho khách hàng mới.        </p>
            <div class="list-moto row">
                <div class="col-md-3  align-items-center moto-item align-items-center">
                    <div class="inner pt-5 pb-3  bg-gray">
                        <div class="col-md-12 moto-header">
                            <h3 class="moto-item-title">
                                <span>Yamaha Sirius 110cc</span>
                            </h3>
                            <p class="moto-item-price"><span>130</span>.000/ Ngày</p>
                        </div>
                        <div class="col-md-12 ">
                            <div class="moto-item-info"></div>
                        </div>
                        <div class="col-md-12 text-center moto-link">
                            <a href=""><img width="600" height="350" src="{% static 'images/xemay/Yamaha Sirius 110cc.png' %}" class="lazyloaded" data-ll-status="loaded"></a>
                            <a href="#chon-dia-diem" class="btn btn-rental" data-loai-xe="Yamaha Sirius 110cc">Đặt xe</a>
                        </div>
                    </div>
                </div>
                <div class="col-md-3  align-items-center moto-item align-items-center">
                    <div class="inner pt-5 pb-3  bg-gray">
                        <div class="col-md-12 moto-header">
                            <h3 class="moto-item-title">
                                <span>Honda Vision 110cc</span>
                            </h3>
                            <p class="moto-item-price"><span>180</span>.000/ Ngày</p>
                        </div>
                        <div class="col-md-12">
                            <div class="moto-item-info"></div>
                        </div>
                        <div class="col-md-12 text-center moto-link">
                            <a href=""><img width="600" height="350" src="{% static 'images/xemay/Honda Vision 110cc.png' %}" class="lazyloaded" data-ll-status="loaded"></a>
                            <a href="#chon-dia-diem" class="btn btn-rental" data-loai-xe="Honda Vision 110cc">Đặt xe</a>
                        </div>
                    </div>
                </div>
                <div class="col-md-3  align-items-center moto-item align-items-center">
                    <div class="inner pt-5 pb-3  bg-gray">
                        <div class="col-md-12 moto-header">
                            <h3 class="moto-item-title"><span>Honda AirBlade 125cc</span></h3>
                            <p class="moto-item-price"><span>200</span>.000/ Ngày</p>
                        </div>
                        <div class="col-md-12 ">
                            <div class="moto-item-info"></div>
                        </div>
                        <div class="col-md-12 text-center moto-link">
                            <a href=""><img width="600" height="350" src="{% static 'images/xemay/Honda Air Blade 125cc.png' %}" class="lazyloaded" data-ll-status="loaded"></a>
                            <a href="#chon-dia-diem" class="btn btn-rental" data-loai-xe="Honda AirBlade 125cc">Đặt xe</a>
                        </div>
                    </div>
                </div>
                <div class="col-md-3  align-items-center moto-item align-items-center">
                    <div class="inner pt-5 pb-3  bg-gray">
                        <div class="col-md-12 moto-header">
                            <h3 class="moto-item-title"><span>Honda WinnerX 150cc</span></h3>
                            <p class="moto-item-price"><span>300</span>.000/ Ngày</p>
                        </div>
                        <div class="col-md-12 ">
                            <div class="moto-item-info"></div>
                        </div>
                        <div class="col-md-12 text-center moto-link">
                            <a href=""><img width="600" height="350" src="{% static 'images/xemay/Honda WinnerX 150cc.png' %}" class="lazyloaded" data-ll-status="loaded"></a>
                            <a href="#chon-dia-diem" class="btn btn-rental" data-loai-xe="Honda WinnerX 150cc">Đặt xe</a>
                        </div>
                    </div>
                </div>
            </div>
            <div class="popup" id="chon-dia-diem">
                <div class="popup__content">
                  <h4 style="color:black;">Bạn muốn thuê xe ở đâu?</h4>
                  <h4 style="color:black;">Loại xe này hiện đang có tại các địa điểm dưới đây.</h4>
                  <br>
                  <p class="popup__text">
                    <select id="chon-dia-diem-select" class="selectpicker form-control" name="pickup_location">
                        <option>Chọn điểm nhận xe</option> 
                    </select>
                  </p>
                  <a href="" class="button">Đóng</a>
                  <a href="" class="button save-loaixe-to-session">Thuê</a>
                </div>
            </div>
            <div class="cta-bottom">
                <p class="text-center">
                    Để thuê xe máy dài ngày, vui lòng xem chi tiết bảng giá dưới đây!</p>
                <p class="text-center line-bottom">
                    <a href="#" class="btn btn-price btn-line btn-yellow">Bảng giá thuê xe máy dài ngày</a>
                </p>
            </div>
        </div>
    </section>
    {% include "rent/thue_xe_tai.html" %}
{% endblock %}
{% block myjs %}
    {{ block.super }}
    <script src="{% static 'rent/chucnangthuexe/js/today.js' %}"></script>
    <script>
        const sorting = document.querySelector('#pickup_location');
        const commentSorting = document.querySelector('#return_location');

        const sortingChoices = new Choices(sorting, {
            placeholder: true,
            itemSelectText: '',
            allowHTML: true
        });

        const commentSortingChoices = new Choices(commentSorting, {
            placeholder: true,
            itemSelectText: '',
            allowHTML: true
        });

        let sortingClass = sorting.getAttribute('class');
        let commentSortingClass = commentSorting.getAttribute('class');

        window.onload = function () {
            sorting.parentElement.setAttribute('class', sortingClass);
            commentSorting.parentElement.setAttribute('class', commentSortingClass);
        }

        
        
        document.addEventListener('DOMContentLoaded', function() {
            const checkbox = document.querySelector('#same-return');
            const returnLocWrapper = document.querySelector('#return_loc_wrapper');
        
            checkbox.addEventListener('change', function() {
                if (this.checked) {
                    returnLocWrapper.style.display = 'none';
                } else {
                    returnLocWrapper.style.display = 'block';
                }
            });
        });

        $(document).ready(function(){
            $('#thue-xe-form').on('submit', function(e){
                if($('#pickup_location').val() == 'Chọn điểm nhận xe' || $('#today').val() == '' || $('#return-day').val() == ''){
                    e.preventDefault();
                    alert('Vui lòng cho biết đầy đủ thông tin thuê xe.');
                }
            });
        });

        
    </script>
    <script type="text/javascript">
		jQuery(document).ready(function($) {
			var list_moto = $('.s-list-moto .list-moto');
			if(list_moto.children('.moto-item').length > 4){
				list_moto.slick({
					infinite: true,
					arrows:false,
					dots:true,
					slidesToShow: 3,
					slidesToScroll: 1
				});
			}
		});
	</script>
    <script>
        $(document).ready(function() {
            $('.btn-rental').click(function(e) {
                e.preventDefault();  
                const loai_xe = $(this).data('loai-xe');
                $.ajax({
                    url: '{% url "rent:chon-dia-diem-at-home" %}',  
                    type: 'POST',
                    data: {
                        'loai_xe': loai_xe,
                        'csrfmiddlewaretoken': $('input[name=csrfmiddlewaretoken]').val()
                    },
                    success: function(data) {
                        console.log(data);
                        const select = document.getElementById('chon-dia-diem-select');
                        select.innerHTML = '';
                    
                        if (data.ds_dia_diem_theo_xe.length === 0) {
                            const option = document.createElement('option');
                            option.text = "Không có địa điểm có sẵn";
                            select.add(option);
                        } else {
                            const option = document.createElement('option');
                            option.text = "Chọn điểm nhận xe";
                            select.add(option);
                            data.ds_dia_diem_theo_xe.forEach(dia_diem => {
                                const option = document.createElement('option');
                                option.text = dia_diem.ten;
                                select.add(option);
                            });
                        }
                    }
                });
                window.location.hash = 'chon-dia-diem';
            });
        });

        $(document).ready(function() {
            $('#chon-dia-diem-select').change(function() {
                const pickup_location = $(this).val();
                $.ajax({
                    url: '{% url "rent:get-min-vehicle_id" %}',  
                    type: 'POST',
                    data: {
                        'pickup_location': pickup_location,
                        'csrfmiddlewaretoken': $('input[name=csrfmiddlewaretoken]').val()
                    },
                    success: function(data) {
                        console.log(data);
                        const vehicle_id = data.vehicle_id;
                        const baseUrl = '/thue-xe-tai-';
                        const href = `${baseUrl}${pickup_location}/phukien-${vehicle_id}`;
                        $('.save-loaixe-to-session').attr('href', href);
                    }
                });
            });
        });
    </script>
    
{% endblock %}